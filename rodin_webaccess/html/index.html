<!-- Background overlay (click-to-close) -->
<div id="overlay" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.45);
    display: none;
    z-index: 1;
"></div>

<!-- Main web iframe -->
<iframe id="webframe" style="
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 85%;
    height: 85%;
    display: none;
    border: none;
    border-radius: 12px;
    z-index: 2;
"></iframe>

<script>
// Open/close UI
window.addEventListener("message", (event) => {
    const frame = document.getElementById("webframe");
    const overlay = document.getElementById("overlay");

    if (event.data.action === "open") {
        frame.src = event.data.url;
        frame.style.display = "block";
        overlay.style.display = "block";
    }

    if (event.data.action === "close") {
        frame.style.display = "none";
        frame.src = "";
        overlay.style.display = "none";
    }
});

// Click overlay to close
document.getElementById("overlay").addEventListener("click", () => {
    fetch(`https://${GetParentResourceName()}/close`, {
        method: "POST",
        body: "{}"
    });
});

// ESC / Backspace to close
document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" || e.key === "Backspace") {
        fetch(`https://${GetParentResourceName()}/close`, {
            method: "POST",
            body: "{}"
        });
    }
});
</script>
